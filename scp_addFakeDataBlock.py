#
#__   _____ ___ ___        Author: Vincent BESSON
# \ \ / /_ _| _ ) _ \      Release: 0.1
#  \ V / | || _ \   /      Date: 2024
#   \_/ |___|___/_|_\      Description: Apple Disk II Emulator data script
#                2024      Licence: Creative Commons
#______________________



# python3 tx_dump_checker.py ./dump/dump_tx_trk0_p1.bin ./imageFiles/BII.nic

import pandas as pd
import numpy as np
from bitstring import Bits, BitArray, BitStream, pack, options
import sys


def file2buf(NICname,buf,blockNumber):
    file = open(NICname, "rb")
    
    indx=0
    # Reading the first three bytes from the binary file
    
    file.seek(512*blockNumber)

    data = file.read(512)
    buf=data
    print ("here")
    file.close()
    return data
    

def buf2fil(destFile,buf,blockNumber):
     file = open(destFile, "r+b")
     file.seek(512*blockNumber)
     file.write(buf)
     file.close
     return

buffer=bytearray()
#buffer=file2buf(sys.argv[1],buffer,176)

bufz=bytearray(512)
bufz.__init__(512)
#s=Bits(bufz)  
#s.pp()


itemCount=7
bufz=bytearray([ 0x20,                  # Return code
                 itemCount,             # Number of Item
                 0x00,                  # current Page
                 0x00,                  # MaxPage
                 0x00,
                 0x00                           
                ])


#tab=[   "TMAIN MENU","D.","D..","FLEMMINGS.WOZ","FCOMMANDO.DSK","FBOUNCING KAMUNGAS","FSPACE INVADERS",""]
tab=["TMAIN MENU","E","MFAVORITE","MFILE MANAGER","E ","VEMULATION|DISKII","MABOUT","",""]
offset=32

bufz[6:]=("MAIN MENU".ljust(23)).encode(encoding="utf-8")
bufz.append(0)
bufz.append(0)
bufz.append(0)
for i in range (0,itemCount+1):
    pos=i*24+offset
    print(i)
    l=len(tab[i])
    bufz[pos:]=(tab[i]).encode(encoding="utf-8")
    for k in range(l,25):
        bufz.append(0)
   
desired_length = 512
padding_byte = b'\x00'
while len(bufz) < desired_length:
    bufz += padding_byte




"""
bufz=bytearray([
0x20, 0x0F, 0x00, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, # 0000:0F
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, # 0010
0x01, 0xAE, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, # 0020
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0xAE, 0xAE, 0x00, 0x00, 0x00, 0x00, 0x00, # 0030
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, # 0040
0x00, 0xC3, 0xE8, 0xE1, 0xED, 0xF0, 0xE9, 0xEF, 0xEE, 0xF3, 0xE8, 0xE9, 0xF0, 0xA0, 0xCC, 0xEF, # 0050
0xE4, 0xE5, 0xA0, 0xD2, 0xF5, 0xEE, 0xEE, 0xE5, 0x00, 0xC7, 0xE1, 0xEC, 0xE1, 0xF8, 0xE9, 0xE1, # 0060
0xEE, 0xAE, 0xC4, 0xD3, 0xCB, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, # 0070
0x00, 0xCB, 0xEF, 0xF2, 0xEF, 0xEE, 0xE9, 0xF3, 0xA0, 0xD2, 0xE9, 0xE6, 0xF4, 0xAE, 0xE4, 0xF3, # 0080
0xEB, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xCB, 0xF5, 0xEE, 0xE7, 0xA0, 0xC6, 0xF5, # 0090
0xA0, 0xCD, 0xE1, 0xF3, 0xF4, 0xE5, 0xF2, 0xAE, 0xC4, 0xD3, 0xCB, 0x00, 0x00, 0x00, 0x00, 0x00, # 00A0
0x00, 0xCC, 0xEF, 0xE4, 0xE5, 0xA0, 0xD2, 0xF5, 0xEE, 0xEE, 0xE5, 0xF2, 0xAE, 0xC4, 0xD3, 0xCB, # 00B0
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xCD, 0xEF, 0xEF, 0xEE, 0xA0, 0xD0, 0xE1, # 00C0
0xF4, 0xF2, 0xEF, 0xEC, 0xAE, 0xC4, 0xD3, 0xCB, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, # 00D0
0x00, 0xD2, 0xE5, 0xF3, 0xE3, 0xF5, 0xE5, 0xA0, 0xD2, 0xE1, 0xE9, 0xE4, 0xE5, 0xF2, 0xF3, 0xA0, # 00E0
0xB1, 0xAE, 0xB2, 0xAE, 0xE4, 0xF3, 0xEB, 0x00, 0x00, 0xD2, 0xE5, 0xF3, 0xE3, 0xF5, 0xE5, 0xA0, # 00F0

0xD2, 0xE1, 0xE9, 0xE4, 0xE5, 0xF2, 0xF3, 0xAE, 0xC4, 0xD3, 0xCB, 0x00, 0x00, 0x00, 0x00, 0x00, # 0100
0x00, 0xD3, 0xEB, 0xF9, 0xE6, 0xEF, 0xF8, 0xAE, 0xC4, 0xD3, 0xCB, 0x00, 0x00, 0x00, 0x00, 0x00, # 0110
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xD3, 0xEE, 0xEF, 0xEF, 0xF0, 0xF9, 0xA0, # 0120
0xD4, 0xEF, 0xA0, 0xD4, 0xE8, 0xE5, 0xA0, 0xD2, 0xE5, 0xF3, 0xE3, 0xF5, 0xE5, 0xAE, 0xC4, 0xD3, # 0130
0x00, 0xE3, 0xE8, 0xE1, 0xED, 0xF0, 0xE9, 0xEF, 0xEE, 0xF3, 0xE8, 0xE9, 0xF0, 0xDF, 0xEC, 0xEF, # 0140
0xE4, 0xE5, 0xDF, 0xF2, 0xF5, 0xEE, 0xEE, 0xE5, 0x00, 0xF0, 0xF2, 0xE9, 0xEE, 0xE3, 0xE5, 0xA0, # 0150
0xEF, 0xE6, 0xA0, 0xF0, 0xE5, 0xF2, 0xF3, 0xE9, 0xE1, 0xA0, 0xF3, 0xE9, 0xE4, 0xE5, 0xA0, 0xE1, # 0160
0x00, 0xF0, 0xF2, 0xE9, 0xEE, 0xE3, 0xE5, 0xA0, 0xEF, 0xE6, 0xA0, 0xF0, 0xE5, 0xF2, 0xF3, 0xE9, # 0170
0xE1, 0xA0, 0xF3, 0xE9, 0xE4, 0xE5, 0xA0, 0xE2, 0xA0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00  # 0180
]);
"""

#buf2fil(sys.argv[2],buffer,176)

blockOffset=int(sys.argv[2])
buf2fil(sys.argv[1],bufz,blockOffset)

s=Bits(bufz)  
s.pp('bin8,hex',width=110)